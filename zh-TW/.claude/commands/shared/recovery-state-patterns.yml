# æ¢å¾©èˆ‡ç‹€æ…‹ç®¡ç† - çµ±ä¸€æ¨¡å¼
# å…¨é¢çš„ç‹€æ…‹ä¿å­˜ã€æœƒè©±æ¢å¾©å’ŒéŒ¯èª¤è™•ç†

## åœ–ä¾‹
@include universal-constants.yml#Universal_Legend

## æª¢æŸ¥é»æ¶æ§‹

```yaml
Checkpoint_Structure:
  Storage_Hierarchy:
    Base_Directory: ".claudedocs/checkpoints/"
    Active_Checkpoint: ".claudedocs/checkpoints/active/"
    Archive_Directory: ".claudedocs/checkpoints/archive/"
    Recovery_Cache: ".claudedocs/checkpoints/recovery/"
    
  Checkpoint_Components:
    Metadata:
      checkpoint_id: "UUID v4 æ ¼å¼"
      timestamp: "ISO 8601 å«æ™‚å€"
      operation: "è§¸ç™¼æª¢æŸ¥é»çš„æŒ‡ä»¤"
      risk_level: "LOW|MEDIUM|HIGH|CRITICAL"
      
    State_Preservation:
      modified_files: "åˆ—è¡¨ â†’ å¿«ç…§ w/ å…§å®¹é›œæ¹Š"
      git_state: "åˆ†æ”¯ã€æäº¤ SHAã€æœªæäº¤çš„è®Šæ›´"
      session_context: "æŒ‡ä»¤æ­·å²ã€å¾…è¾¦äº‹é …ã€æ±ºç­–ã€é˜»ç¤™"
      environment: "å·¥ä½œç›®éŒ„ã€ç’°å¢ƒè®Šæ•¸ã€å·¥å…·ç‰ˆæœ¬"
      mcp_cache: "æ´»å‹•ä¼ºæœå™¨ã€å¿«å–å›æ‡‰ã€æ¬Šæ–ä½¿ç”¨"

Automatic_Triggers:
  Risk_Based:
    Critical: ["è³‡æ–™åº«é·ç§»", "ç”Ÿç”¢éƒ¨ç½²", "å®‰å…¨è®Šæ›´"]
    High: ["å¤šæª”æ¡ˆé‡æ§‹", "ç›¸ä¾æ€§æ›´æ–°", "æ¶æ§‹è®Šæ›´"]
    Medium: ["åŠŸèƒ½å¯¦ä½œ", "å½±éŸ¿ 3+ æª”æ¡ˆçš„éŒ¯èª¤ä¿®å¾©"]
    
  Time_Based:
    Long_Operations: "æ¯ 10 åˆ†é˜æª¢æŸ¥é»ç”¨æ–¼ >5 åˆ†é˜çš„æ“ä½œ"
    Session_Duration: "æ¯ 30 åˆ†é˜æª¢æŸ¥é»"
    
  Command_Specific:
    Always: ["/deploy", "/migrate", "/cleanup --aggressive"]
    Conditional: ["/build â†’ æ ¸å¿ƒç³»çµ±", "/test â†’ åŸºç¤è¨­æ–½"]
```

## æœƒè©±æ¢å¾©æ¨¡å¼

```yaml
Session_Detection:
  Startup_Scan:
    Locations: [".claudedocs/tasks/in-progress/", ".claudedocs/tasks/pending/"]
    Parse_Metadata: "æ“·å–ä»»å‹™ IDã€æ¨™é¡Œã€ç‹€æ…‹ã€åˆ†æ”¯ã€é€²åº¦"
    Git_Validation: "æª¢æŸ¥åˆ†æ”¯å­˜åœ¨ã€ä¹¾æ·¨çš„å·¥ä½œæ¨¹"
    Context_Restoration: "è¼‰å…¥æœƒè©±ç‹€æ…‹ã€è®Šæ•¸ã€æ±ºç­–"
    
  Recovery_Decision_Matrix:
    Active_Tasks_Found: "è‡ªå‹•æ¢å¾©æœ€è¿‘æˆ–æœ€é«˜å„ªå…ˆç´š"
    Multiple_Tasks: "å‘ˆç¾é¸æ“‡é¸å–® w/ é€²åº¦æ‘˜è¦"
    Stale_Tasks: ">7 å¤©çš„ä»»å‹™éœ€è¦ç¢ºèª"
    Corrupted_State: "å›é€€ â†’ æ‰‹å‹•æ¢å¾©æç¤º"

Context_Recovery:
  State_Reconstruction:
    File_Context: "æ¢å¾©å·¥ä½œæª”æ¡ˆåˆ—è¡¨å’Œä¿®æ”¹è¿½è¹¤"
    Variable_Context: "é‡æ–°è¼‰å…¥æœƒè©±è®Šæ•¸å’Œè¨­å®š"
    Decision_Context: "æ¢å¾©æ¶æ§‹å’Œå¯¦ä½œæ±ºç­–"
    Progress_Context: "å¾ä»»å‹™åˆ†è§£å’Œéšæ®µé‡å»ºå¾…è¾¦äº‹é …åˆ—è¡¨"
    
  Automatic_Recovery:
    Seamless_Resume: "å–®ä¸€æ´»å‹•ä»»å‹™çš„éœé»˜æ¢å¾©"
    Smart_Restoration: "å¾ä»»å‹™ç‹€æ…‹å’Œé€²åº¦é‡å»º TodoWrite"
    Blocker_Detection: "è­˜åˆ¥ä¸¦å‘ˆç¾å…ˆå‰çš„é˜»ç¤™"
    Next_Step_ID: "ç¢ºå®šæœ€ä½³ä¸‹ä¸€æ­¥å‹•ä½œ"

session_state_format:
  current_files: [path1, path2]
  key_variables:
    api_endpoint: "https://api.example.com"
    database_name: "myapp_prod"
  decisions:
    - "å› åœ˜éšŠç†Ÿæ‚‰åº¦é¸æ“‡ React è€Œé Vue"
  blockers:
    - issue: "API å‘¼å«çš„ CORS éŒ¯èª¤"
      attempted: ["æ¨™é ­", "ä»£ç†è¨­å®š"]
      solution: "éœ€è¦ä¼ºæœå™¨ç«¯ CORS è¨­å®š"
```

## éŒ¯èª¤åˆ†é¡èˆ‡æ¢å¾©

```yaml
Error_Categories:
  Transient_Errors:
    Examples: ["ç¶²è·¯é€¾æ™‚", "è³‡æºä¸å¯ç”¨", "API é€Ÿç‡é™åˆ¶"]
    Recovery: "æŒ‡æ•¸é€€é¿é‡è©¦ (æœ€å¤š 3 æ¬¡å˜—è©¦)"
    
  Environment_Errors:
    Examples: ["æ‰¾ä¸åˆ°æŒ‡ä»¤", "æœªå®‰è£æ¨¡çµ„", "æ¬Šé™è¢«æ‹’"]
    Recovery: "æŒ‡å°ä½¿ç”¨è€… â†’ ç’°å¢ƒä¿®å¾©"
    Auto_Fix: "å¦‚æœå¯èƒ½å‰‡å˜—è©¦"
    
  Validation_Errors:
    Examples: ["ç„¡æ•ˆæ ¼å¼", "èªæ³•éŒ¯èª¤", "ç¼ºå°‘åƒæ•¸"]
    Recovery: "è«‹æ±‚æœ‰æ•ˆè¼¸å…¥ w/ å…·é«”ç¯„ä¾‹"
    
  Logic_Errors:
    Examples: ["å¾ªç’°ç›¸ä¾æ€§", "è¡çªéœ€æ±‚"]
    Recovery: "è§£é‡‹å•é¡Œä¸¦æä¾›æ›¿ä»£æ–¹æ¡ˆ"
    
  Critical_Errors:
    Examples: ["è³‡æ–™æå£", "å®‰å…¨é•è¦", "ç³»çµ±æ•…éšœ"]
    Recovery: "å®‰å…¨æ¨¡å¼ + æª¢æŸ¥é» + ä½¿ç”¨è€…ä»‹å…¥"

Standard_Recovery_Patterns:
  Retry_Strategies:
    Exponential_Backoff:
      Initial_Delay: 1000ms
      Max_Delay: 30000ms
      Multiplier: 2
      Jitter: "éš¨æ©Ÿ 0-500ms"
      
    Circuit_Breaker:
      Failure_Threshold: 5
      Reset_Timeout: 60000ms
      Use_Case: "ä¿è­·æ•…éšœæœå‹™"

  Fallback_Chains:
    Tool_Failures: "grep â†’ rg â†’ åŸç”Ÿæœå°‹ â†’ æŒ‡å°ä½¿ç”¨è€…"
    MCP_Cascades:
      Context7: "â†’ WebSearch â†’ æœ¬åœ°å¿«å– â†’ ç¹¼çºŒ w/ è­¦å‘Š"
      Sequential: "â†’ åŸç”Ÿåˆ†æ â†’ ç°¡åŒ– â†’ ä½¿ç”¨è€…è¼¸å…¥"
      Magic: "â†’ ç¯„æœ¬ç”Ÿæˆ â†’ æ‰‹å‹•æŒ‡å— â†’ ç¯„ä¾‹"
      
  Graceful_Degradation:
    Feature_Reduction: "å®Œæ•´ â†’ åŸºæœ¬ â†’ æœ€å° â†’ æ‰‹å‹•æŒ‡å—"
    Performance_Adaptation: "æ¸›å°‘ç¯„åœ â†’ æ›´å¿«çš„æ›¿ä»£æ–¹æ¡ˆ â†’ æ¼¸é€²å¼è¼¸å‡º"
```

## æ¢å¾©å¯¦ä½œ

```yaml
Recovery_Framework:
  Error_Handler_Lifecycle:
    Detect: "æ•ç² â†’ åˆ†é¡ â†’ è©•ä¼°åš´é‡æ€§ â†’ æ“·å–ä¸Šä¸‹æ–‡"
    Analyze: "ç¢ºå®šæ¢å¾©é¸é … â†’ æª¢æŸ¥é‡è©¦è³‡æ ¼ â†’ è­˜åˆ¥å›é€€"
    Respond: "è¨˜éŒ„ w/ ä¸Šä¸‹æ–‡ â†’ å˜—è©¦æ¢å¾© â†’ è¿½è¹¤å˜—è©¦ â†’ å‡ç´š"
    Report: "ä½¿ç”¨è€…å‹å¥½è¨Šæ¯ â†’ æŠ€è¡“ç´°ç¯€ â†’ å‹•ä½œ â†’ å¾ŒçºŒæ­¥é©Ÿ"

  Progressive_Escalation:
    Level_1: "è‡ªå‹•é‡è©¦/æ¢å¾©"
    Level_2: "æ›¿ä»£æ–¹æ³•"
    Level_3: "é™ç´šæ“ä½œ"
    Level_4: "æ‰‹å‹•ä»‹å…¥"
    Level_5: "ä¸­æ­¢ w/ å›æ»¾"

Recovery_Commands:
  Checkpoint_Management:
    Create: "/checkpoint [--full|--light] [--note 'è¨Šæ¯']"
    List: "/checkpoint --list [--recent|--today|--filter]"
    Inspect: "/checkpoint --inspect {id}"
    Rollback: "/rollback [--quick|--full] [--files|--git|--env] [{id}]"
    
  Recovery_Actions:
    Quick_Rollback: "åƒ…æª”æ¡ˆå…§å®¹ (æ¬¡ç§’ç´š)"
    Full_Restoration: "å®Œæ•´ç‹€æ…‹ (æª”æ¡ˆã€gitã€ç’°å¢ƒ)"
    Selective_Recovery: "åƒ…ç‰¹å®šå…ƒä»¶"
    Progressive_Recovery: "é€æ­¥ç€è¦½æª¢æŸ¥é»æ­·å²"
```

## æ•´åˆæ¨¡å¼

```yaml
Command_Integration:
  Lifecycle_Hooks:
    Pre_Execution: "åœ¨é«˜é¢¨éšªæ“ä½œå‰å»ºç«‹æª¢æŸ¥é»"
    During_Execution: "é•·æ“ä½œçš„æ¼¸é€²å¼æ›´æ–°"
    Post_Execution: "æ ¹æ“šçµæœå®Œæˆæˆ–æ¸…ç†æª¢æŸ¥é»"
    On_Failure: "ä¿ç•™æª¢æŸ¥é» â†’ æä¾›ç«‹å³å›æ»¾"

  Error_Context_Capture:
    Operation: "æ­£åœ¨å˜—è©¦ä»€éº¼"
    Environment: "å·¥ä½œç›®éŒ„ã€ä½¿ç”¨è€…ã€æ¬Šé™"
    Input: "å¤±æ•—çš„æŒ‡ä»¤/åƒæ•¸"
    Output: "éŒ¯èª¤è¨Šæ¯å’Œæ—¥èªŒ"
    State: "éŒ¯èª¤ç™¼ç”Ÿæ™‚çš„ç³»çµ±ç‹€æ…‹"

Common_Error_Scenarios:
  Development:
    Module_Not_Found: "æª¢æŸ¥ package.json â†’ npm install â†’ é©—è­‰åŒ¯å…¥"
    Build_Failures: "æ¸…ç†å¿«å– â†’ æª¢æŸ¥èªæ³• â†’ é©—è­‰ç›¸ä¾æ€§ â†’ éƒ¨åˆ†å»ºç½®"
    Test_Failures: "éš”é›¢å¤±æ•— â†’ æª¢æŸ¥ç’°å¢ƒ â†’ è·³éä¸¦ç¹¼çºŒ"
    
  System:
    Permission_Denied: "chmod/chown å»ºè­° â†’ æ›¿ä»£ä½ç½® â†’ ä½¿ç”¨è€…ç›®éŒ„å›é€€"
    Disk_Space: "æ¸…ç†è‡¨æ™‚æª”æ¡ˆ â†’ å»ºè­°æ¸…ç† â†’ å£“ç¸® â†’ æœ€å°æ¨¡å¼"
    Memory_Exhaustion: "æ¸›å°‘ç¯„åœ â†’ ä¸²æµ â†’ æ‰¹æ¬¡è™•ç† â†’ æ‰‹å‹•åˆ†å¡Š"
    
  Integration:
    API_Failures: "401/403â†’é©—è­‰ | 429â†’é€Ÿç‡é™åˆ¶ | 500â†’é‡è©¦ | å¿«å–å›é€€"
    Network_Issues: "é‡è©¦ w/ é€€é¿ â†’ æ›¿ä»£ç«¯é» â†’ å¿«å–è³‡æ–™ â†’ é›¢ç·šæ¨¡å¼"

User_Experience:
  Status_Messages:
    Starting_Recovery: "ğŸ”„ åµæ¸¬å…ˆå‰çš„æœƒè©±ç‹€æ…‹..."
    Task_Found: "ğŸ“‹ æ‰¾åˆ°æ´»å‹•ä»»å‹™: {title} ({progress}% å®Œæˆ)"
    Context_Restored: "âœ… æœƒè©±ä¸Šä¸‹æ–‡å·²æ¢å¾© - ç¹¼çºŒå·¥ä½œ"
    Recovery_Failed: "âš  éœ€è¦æ‰‹å‹•æ¢å¾©"
    
  Error_Communication:
    What: "å»ºç½®å¤±æ•—: æ‰¾ä¸åˆ°æ¨¡çµ„"
    Why: "å¥—ä»¶ 'react' æœªå®‰è£"
    How: "åŸ·è¡Œ: npm install react"
    Then: "é‡è©¦å»ºç½®æŒ‡ä»¤"
```

## æ•ˆèƒ½æœ€ä½³åŒ–

```yaml
Efficiency_Strategies:
  Incremental_Checkpoints: "åŸºç¤æª¢æŸ¥é» + å¢é‡æ›´æ–°"
  Parallel_Processing: "ä¸¦è¡Œæª”æ¡ˆå‚™ä»½å’Œç‹€æ…‹æ”¶é›†"
  Smart_Selection: "åƒ…å‚™ä»½å—å½±éŸ¿çš„æª”æ¡ˆ â†’ æ·ºè¤‡è£½æœªè®Šæ›´çš„"
  Resource_Management: "ä¸²æµå¤§æª”æ¡ˆ â†’ é™åˆ¶ CPU â†’ ä½å„ªå…ˆç´š I/O"

Retention_Policy:
  Automatic_Cleanup: "7 å¤©æœŸé™ | 20 å€‹è¨ˆæ•¸é™åˆ¶ | 1GB å¤§å°é™åˆ¶"
  Protected_Checkpoints: "ä½¿ç”¨è€…æ¨™è¨˜ â†’ æ°¸ä¸è‡ªå‹•åˆªé™¤"
  Archive_Strategy: "Tar.gz èˆŠæª¢æŸ¥é» â†’ ä¸­ç¹¼è³‡æ–™ä¿ç•™"
```

---
*æ¢å¾©èˆ‡ç‹€æ…‹ç®¡ç† v3 - ç‹€æ…‹ä¿å­˜ã€æœƒè©±æ¢å¾©å’ŒéŒ¯èª¤è™•ç†çš„çµ±ä¸€æ¨¡å¼*